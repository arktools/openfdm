// options
setCommandLineOptions({
//"+showErrorMessages",
"+preOptModules=inlineArrayEqn,partitionIndependentBlocks",
"+postOptModules=inlineArrayEqn,constantLinearSystem,removeSimpleEquations,generateSymbolicLinearization",
//"+a",
//"+noSimplify",
"+d=linearization,gendebugsymbols"
});

// this line required the project path to be appended to OPENMODELICALIBRARY
loadModel(Modelica);
loadModel(Aerosonde);
loadModel(OpenFDM);
loadModel(test);
getErrorString();


// it is necessary to extract the model form all packages so the "." is not mis-read
system("rm -f linear_AerosondeModel.mo AerosondeModel.*");
loadString("
model AerosondeModel
  extends test.AerosondeModel;
end AerosondeModel;
");

// get linear model
simulate(AerosondeModel,
    stopTime=0.001,
    numberOfIntervals=1,
    measureTime=false);
//getErrorString();
system("./AerosondeModel -l 0 > log.out");
readFile("log.out");
loadFile("linear_AerosondeModel.mo");
//getErrorString();
list(linear_AerosondeModel);
//getErrorString();

// simulate non-linear model
simulate(AerosondeModel,
    stopTime=1000,
    numberOfIntervals=100000,
    measureTime=false);

plotParametric(p.r_r[1],p.agl);
//system("chromium-browser $PWD/AerosondeModel_prof.html &");
//getErrorString();
