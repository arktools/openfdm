// options
setCommandLineOptions({"+d=linearization"});

// this line required the project path to be appended to OPENMODELICALIBRARY
loadModel(Modelica);
loadModel(OpenFDM);

// it is necessary to extract the model form all packages so the "." is not mis-read
system("echo \"model TestModel2 extends OpenFDM.Examples.TestModel; end TestModel2;\" > TestModel2.mo");
loadFile("TestModel2.mo");

// get linear model
simulate(TestModel2,numberOfIntervals=1);
system("./TestModel2 -l 0 > log.out"); readFile("log.out");
loadFile("/tmp/linear_TestModel2.mo");
list(linear_TestModel2);

// simulate non-linear model
simulate(TestModel2);
plot({body.pN,body.pE});
simulate(linear_TestModel2);
plot({x[1],x[2]});